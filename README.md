# TrapFinder (トラップファインダー)

## 概要
TrapFinderは、契約書や利用規約などの文書をAIが解析し、**ユーザーにとって注意すべきポイント**を分かりやすく提示する**万能ドキュメント解析AI**です。
ユーザーが予期せぬ不利益（隠れた費用、権利の放棄、一方的なルール変更など）を被らないよう、同意ボタンを押す前にチェックすべきポイントを分かりやすく提示します。

> **重要**: 本アプリは法的助言を提供するものではありません。あくまでユーザー自身の読解と判断をサポートする補助ツールです。

## コンセプト
*   **脱・読み飛ばし**: 長くて難しい規約も、AIが要点を絞ってくれるので確認しやすい。
*   **転ばぬ先の杖**: 「こんなはずじゃなかった」という同意後のトラブルを未然に防ぐ。
*   **中立・客観的**: 感情的な煽りや過度な警告を避け、事実に基づいた注意喚起を行う。
*   **汎用性**: 契約書だけでなく、請求書、通知、ニュース記事、個人メモなど、あらゆる文書に対応。

## 主な機能

### 1. ドキュメントスキャン
以下の方法で文書を取り込むことができます。
*   **カメラ撮影**: 紙の契約書をその場でスキャン。
*   **フォトライブラリ**: 保存済みの画像から読み込み。
*   **PDFファイル**: クラウドやメール添付のPDFを解析（複数ページ対応）。
*   **テキスト入力**: ウェブサイトの規約などをコピペして解析（プランにより最大10,000〜50,000文字）。
*   **URL入力**: WebページのURLを入力して、ページ内容を自動取得・解析。

※ **文字数制限**: プランにより異なります。フリープランは10,000文字/回、スタンダード・プロプランは50,000文字/回まで。

### 2. AI解析 (Universal Document Analysis)
OpenAI APIを使用し、文書の種類を自動判定して以下の観点で解析を行います。
*   **フリープラン・スタンダードプラン**: GPT-4o-miniを使用
*   **プロプラン**: GPT-4oを使用（1日20回まで、制限到達時は自動でGPT-4o-miniに切り替え）
*   **リスク管理モード**: 契約書・規約など → 不利益な条項、隠れた費用、権利の放棄などを検出
*   **コスト管理モード**: 請求書・見積書など → 金額の妥当性、追加費用の有無などを検出
*   **情報整理モード**: 通知・メールなど → 重要な情報、アクションアイテムなどを抽出
*   **校正・作成支援モード**: 個人メモ・文章など → 誤字脱字、改善点などを指摘

### 3. 解析レポート (Analysis Result)
*   **文書タイプ判定**: AIが自動的に文書の種類を判定
*   **確認すべきポイント**: 特に注意して読むべき条項をリストアップ（件数バッジ付き）
*   **詳細な解説**: 専門用語を使わず、背景や理由まで含めて親切・丁寧に解説
*   **エクスポート機能**: 解析結果をテキスト形式でエクスポート可能

## プラン構成

### フリープラン
*   AIモデル: GPT-4o-mini
*   スキャン回数: 動画広告視聴で回数無制限
*   文字数制限: 10,000文字/回
*   価格: 無料

### スタンダードプラン
*   AIモデル: GPT-4o-mini
*   スキャン回数: 無制限
*   文字数制限: 50,000文字/回
*   価格: ¥780/月

### プロプラン
*   AIモデル: GPT-4o（1日10回まで、制限到達時は自動でGPT-4o-miniに切り替え）
*   スキャン回数: 1日10回まで（制限到達後も標準AIで無制限利用可能）
*   文字数制限: 50,000文字/回
*   価格: ¥1,180/月

## 技術スタック
*   **言語**: Swift (iOS 15.0+)
*   **UIフレームワーク**: SwiftUI
*   **AI**: OpenAI API (GPT-4o-mini)
*   **OCR**: Vision Framework, PDFKit
*   **課金**: StoreKit 2 (Apple公式API)
*   **多言語対応**: 日本語・英語（UIとAI出力の両方）

## セットアップ手順

### 1. APIキーの設定
1. `App/App/Config/AppConfig.example.swift` を `AppConfig.swift` にコピー
2. `AppConfig.swift` に実際のAPIキーを設定：
   - `revenueCatAPIKey`: RevenueCatダッシュボードから取得（`appl_` で始まる公開キー）
   - `openAIAPIKey`: OpenAI APIキー（`sk-` で始まる）

### 2. App Store Connectでの設定（必須）
StoreKit 2を使用するため、App Store Connectでサブスクリプション製品を設定する必要があります。

**詳細な手順は `SETUP_GUIDE.md` を参照してください。**

#### 簡単な手順：
1. [App Store Connect](https://appstoreconnect.apple.com/) にログイン
2. アプリを選択（または新規作成）
3. **「機能」** → **「App内課金」** → **「サブスクリプション」** を選択
4. サブスクリプショングループを作成（初回の場合）
5. サブスクリプション製品を作成：
   - **製品ID**: `standard_monthly` ⚠️ **重要**: `PlanConfiguration.swift` と完全に一致させる
   - **期間**: 1ヶ月
   - **価格**: ¥480
6. サンドボックステスターアカウントを作成（テスト用）

**注意**: 
- 製品IDは `PlanConfiguration.swift` の `standardPlanID` と完全に一致させる必要があります
- テスト環境では、サンドボックステストアカウントで購入をテストできます
- 詳細は `SETUP_GUIDE.md` を参照してください

### 3. （参考）以前のRevenueCat設定（現在は使用していません）

本アプリは現在 **StoreKit 2** を直接使用しています。RevenueCatは使用していません。

### 4. プランIDの確認
`App/App/Config/PlanConfiguration.swift` の `standardPlanID` が、App Store Connectで設定した製品IDと一致していることを確認してください。

### 5. ビルドとテスト
1. 実機またはシミュレーターでビルド
2. サンドボックステストアカウントで購入フローをテスト
   - 設定 → App Store → サンドボックスアカウントでログイン
3. 購入復元機能もテスト

## UI/UX
*   **モダンなカードUI**: 暖色系のカラーパレットを採用
*   **スプラッシュスクリーン**: 起動時に1秒間のロゴアニメーション
*   **直感的な操作**: シンプルで使いやすいインターフェース

## 利用規約・免責事項
本アプリの解析結果はAIによる推論であり、正確性を保証するものではありません。最終的な契約締結や同意の判断は、必ずユーザー自身の責任で行ってください。
